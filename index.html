<!DOCTYPE html>
<html>
<head>
<title>AdOps Macro Validator - Ashish</title>
<style>
body { font-family: Arial; padding: 20px; }
textarea { width: 100%; height: 180px; }
button { padding: 10px 15px; margin-top: 10px; cursor: pointer; }
pre { background: #111; color: #0f0; padding: 10px; white-space: pre-wrap; }
.tab { display:none; }
.tab-btn { padding: 10px; margin-right: 5px; cursor: pointer; }
.active { background: #007bff; color: white; }
</style>
</head>

<body>

<h2>AdOps Macro Validator Tool</h2>

<button class="tab-btn active" onclick="showTab('vast')">VAST</button>
<button class="tab-btn" onclick="showTab('esbo')">ESBO</button>
<button class="tab-btn" onclick="showTab('click')">CLICK</button>

<!-- VAST TAB -->
<div id="vast" class="tab" style="display:block;">
<h3>VAST Macro Replacement</h3>
<textarea id="vastInput" placeholder="Paste multiple trackers line by line"></textarea>
<button onclick="processVAST()">Replace Macros</button>
<pre id="vastOutput"></pre>
</div>

<!-- ESBO TAB -->
<div id="esbo" class="tab">
<h3>ESBO Macro Replacement</h3>
<textarea id="esboInput" placeholder="Paste multiple trackers line by line"></textarea>
<button onclick="processESBO()">Replace Macros</button>
<pre id="esboOutput"></pre>
</div>

<!-- CLICK TAB -->
<div id="click" class="tab">
<h3>Click Macro Replacement</h3>
<textarea id="clickInput" placeholder="Paste multiple trackers line by line"></textarea>
<button onclick="processCLICK()">Replace Macros</button>
<pre id="clickOutput"></pre>
</div>

<script>
// TAB SWITCH
function showTab(id){
  document.querySelectorAll('.tab').forEach(t=>t.style.display='none');
  document.getElementById(id).style.display='block';
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
}

// RANDOM MACRO REPLACEMENTS
function replaceRandomMacros(url){
  return url
    .replace(/\[CACHEBUSTER\]|\[timestamp\]|\[INSERT_CACHEBREAKER_HERE\]|\[INSERT_MACRO\]|CacheBuster|cachebuster/gi, "__RANDOM_NUMBER__");
}

// DYNATA ADVERTISER ID REPLACEMENT
function replaceDynata(url){
  return url.replace(/AdvertiserID=[^&;]+/gi, "AdvertiserID=__DEVICE_UID__");
}

// VAST PROCESS
function processVAST(){
  let lines = document.getElementById("vastInput").value.split("\n");
  let output = lines.map(url=>{
    url = replaceRandomMacros(url);
    url = replaceDynata(url);
    return url;
  }).join("\n\n");
  document.getElementById("vastOutput").textContent = output;
}

// CLICK PROCESS
function processCLICK(){
  let lines = document.getElementById("clickInput").value.split("\n");
  let output = lines.map(url=>{
    url = replaceRandomMacros(url);
    url = replaceDynata(url);
    return url;
  }).join("\n\n");
  document.getElementById("clickOutput").textContent = output;
}

// ESBO PROCESS
function processESBO(){
  let lines = document.getElementById("esboInput").value.split("\n");
  let output = lines.map(url=>{
    url = replaceRandomMacros(url);
    url = replaceDynata(url);

    // INSERT GDPR AFTER tfua=;
    if(url.includes("tfua=") && !url.includes("gdpr=${GDPR};gdpr_consent=${GDPR_CONSENT_755}")){
      url = url.replace(/tfua=([^;]*)/i, match => match + ";gdpr=${GDPR};gdpr_consent=${GDPR_CONSENT_755}");
    }

    // DoubleVerify Rule
    if(url.includes("tps.doubleverify.com/visit.jpg")){
      if(!url.includes("gdpr_consent=${GDPR_CONSENT_126}")){
        url += "&gdpr=${GDPR}&gdpr_consent=${GDPR_CONSENT_126}";
      }
    }

    return url;
  }).join("\n\n");

  document.getElementById("esboOutput").textContent = output;
}
</script>

</body>
</html>
